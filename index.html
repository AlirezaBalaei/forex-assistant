<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Forex Assistant</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400&display=swap"
      rel="stylesheet"
    />
    <link rel="icon" href="assets/icon/128.png" type="image/png" />
    <link rel="manifest" href="manifest.json" />
    <link rel="apple-touch-icon" href="assets/icon/180.png" />
    <style>
      body {
        background: linear-gradient(135deg, #232526 0%, #414345 100%);
        color: #ffffff;
        font-family: 'Roboto Mono', monospace;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: start;
        height: 100vh;
        margin: 0;
        padding: 20px;
      }
      .container {
        width: 100%;
        max-width: 400px;
        padding: 20px;
        background: rgba(30, 30, 30, 0.95);
        border-radius: 16px;
        box-shadow: 0 4px 24px rgba(0, 0, 0, 0.2);
        margin-top: 32px;
      }
      .logo {
        display: flex;
        justify-content: center;
        align-items: center;
        margin-bottom: 24px;
      }
      .logo img {
        width: 80px;
        height: 80px;
        border-radius: 16px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
      }
      .title {
        text-align: center;
        font-size: 2rem;
        font-weight: bold;
        margin-bottom: 8px;
        letter-spacing: 1px;
      }
      .subtitle {
        text-align: center;
        font-size: 1rem;
        color: #b0b0b0;
        margin-bottom: 24px;
      }
      .input-group {
        margin-bottom: 15px;
        display: flex;
        flex-direction: column;
        opacity: 1;
      }
      input#contract:read-only {
        color: #5f5f5f;
      }
      label {
        font-size: 14px;
        margin-bottom: 5px;
      }
      input,
      select {
        width: 100%;
        padding: 10px;
        font-size: 16px;
        border: none;
        border-radius: 5px;
        background-color: #2a2a2a;
        box-sizing: border-box;
        color: #ffffff;
        outline: none;
        margin-bottom: 0;
      }
      button {
        width: 100%;
        padding: 15px;
        font-size: 16px;
        background-color: #4a90e2;
        color: #ffffff;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s;
        margin-top: 10px;
      }
      button:hover {
        background-color: #357ab8;
      }
      .result {
        margin-top: 20px;
        padding: 10px;
        background-color: #333;
        border-radius: 5px;
        font-size: 16px;
        display: flex;
        justify-content: space-between;
      }
      .hidden {
        display: none !important;
      }
      #loss-result {
        color: #ff4c4c;
      }
      @media (max-width: 500px) {
        .container {
          padding: 10px;
        }
        .logo img {
          width: 56px;
          height: 56px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container" id="landing-container">
      <div class="logo">
        <img src="assets/icon/128.png" alt="Forex Assistant Logo" />
      </div>
      <div class="title">Forex Assistant</div>
      <div class="subtitle">Calculate your optimal lot size in seconds</div>
      <div class="input-group">
        <label for="landing-equity">Account Size ($):</label>
        <input type="number" id="landing-equity" value="6000" min="1" />
      </div>
      <div class="input-group">
        <label for="landing-risk">Risk (%):</label>
        <input
          type="number"
          id="landing-risk"
          value="2"
          min="0.01"
          step="0.01"
        />
      </div>
      <div class="input-group">
        <label for="landing-pair">Select Pair:</label>
        <select id="landing-pair">
          <option value="Custom">Custom</option>
          <option value="XAUUSD">XAUUSD</option>
          <option value="GBPUSD">GBPUSD</option>
          <option value="EURUSD">EURUSD</option>
          <option value="USDJPY">USDJPY</option>
        </select>
      </div>
      <div class="input-group hidden" id="landing-contract-group">
        <label for="landing-contract">Contract Size:</label>
        <input type="number" id="landing-contract" value="100" min="1" />
      </div>
      <button id="open-calculator">Open Calculator</button>
    </div>
    <div class="container hidden" id="calculator-container">
      <div class="input-group">
        <label for="equity">Equity ($):</label>
        <input type="number" id="equity" value="6000" />
      </div>
      <div class="input-group">
        <label for="risk">Risk (%):</label>
        <input type="number" id="risk" value="2" />
      </div>
      <div class="input-group">
        <label for="stop">Stop ($):</label>
        <input type="number" id="stop" value="1" />
      </div>
      <div class="input-group">
        <label for="pair">Select Pair:</label>
        <select id="pair">
          <option value="Custom">Custom</option>
          <option value="XAUUSD">XAUUSD</option>
          <option value="GBPUSD">GBPUSD</option>
          <option value="EURUSD">EURUSD</option>
          <option value="USDJPY">USDJPY</option>
        </select>
      </div>
      <div class="input-group hidden" id="usd-price-group">
        <label for="price">USD Price:</label>
        <input type="number" id="price" value="148" />
      </div>
      <div class="input-group">
        <label for="contract">Contract size:</label>
        <input type="number" id="contract" value="100" />
      </div>
      <div class="result">
        <span>Expected Loss:</span>
        <span id="loss-result"></span>
      </div>
      <div class="result">
        <span>Lot Size:</span>
        <span id="lot-result"></span>
      </div>
    </div>
    <script>
      // --- LANDING PAGE LOGIC ---
      function getHashParams() {
        const hash = window.location.hash.replace(/^#\/?/, '');
        const [equity, pair, risk, contract] = hash.split('/');
        return { equity, pair, risk, contract };
      }
      function showCalculatorWithParams(equity, pair, risk, contract) {
        document.getElementById('landing-container').classList.add('hidden');
        document
          .getElementById('calculator-container')
          .classList.remove('hidden');
        if (equity) document.getElementById('equity').value = equity;
        if (pair) document.getElementById('pair').value = pair.toUpperCase();
        if (risk) document.getElementById('risk').value = risk;
        if (contract) document.getElementById('contract').value = contract;
      }
      // Show/hide contract input on landing page
      document.getElementById('landing-pair').onchange = function () {
        const pair = document.getElementById('landing-pair').value;
        const contractGroup = document.getElementById('landing-contract-group');
        if (pair === 'Custom') {
          contractGroup.classList.remove('hidden');
        } else {
          contractGroup.classList.add('hidden');
        }
      };
      // On landing page button click, open new tab with hash params
      document.getElementById('open-calculator').onclick = function () {
        const equity = document.getElementById('landing-equity').value;
        const risk = document.getElementById('landing-risk').value;
        const pair = document.getElementById('landing-pair').value;
        let url = `index.html#/${equity}/${pair}/${risk}`;
        if (pair === 'Custom') {
          const contract = document.getElementById('landing-contract').value;
          url += `/${contract}`;
        }
        window.open(url, '_blank');
      };
      // On load, check if hash params are present
      window.onload = function () {
        const { equity, pair, risk, contract } = getHashParams();
        if (equity && pair && risk) {
          showCalculatorWithParams(equity, pair, risk, contract);
          app(contract);
        } else {
          document
            .getElementById('landing-container')
            .classList.remove('hidden');
          document
            .getElementById('calculator-container')
            .classList.add('hidden');
        }
      };
      // --- CALCULATOR LOGIC (with contract param) ---
      async function app(contractFromHash) {
        let equityInput = document.getElementById('equity');
        let riskInput = document.getElementById('risk');
        let stopInput = document.getElementById('stop');
        let pairInput = document.getElementById('pair');
        let contractInput = document.getElementById('contract');
        let priceInput = document.getElementById('price');
        let usdPriceGroup = document.getElementById('usd-price-group');
        let expectedLossSpan = document.getElementById('loss-result');
        let expectedLotSpan = document.getElementById('lot-result');
        equityInput.onchange = handleChange;
        riskInput.onchange = handleChange;
        stopInput.onchange = handleChange;
        pairInput.onchange = handleChange;
        contractInput.onchange = handleChange;
        priceInput.onchange = handleChange;
        window.ontouchend = window.onclick = handleChange;
        // If contractFromHash is present and pair is custom, set contract size
        if (contractFromHash && pairInput.value === 'Custom') {
          contractInput.value = contractFromHash;
        }
        handleChange();
        function handleChange(event) {
          const pairDictionary = {
            xauusd: { contractSize: 100, nonUSD: false },
            gbpusd: { contractSize: 100000, nonUSD: false },
            eurusd: { contractSize: 100000, nonUSD: false },
            usdjpy: { contractSize: 100000, nonUSD: true },
          };
          const equity = +equityInput?.value;
          const risk = +riskInput?.value;
          const stop = +stopInput?.value;
          const price = +priceInput?.value;
          const pairKey = String(pairInput?.value).trim().toLowerCase();
          const pair = pairDictionary[pairKey];
          // Show/hide USD price for non-USD pairs
          if (pair?.nonUSD) {
            usdPriceGroup.classList.remove('hidden');
          } else {
            usdPriceGroup.classList.add('hidden');
          }
          // Contract size logic
          let contractSize = 0;
          if (pairKey === 'custom') {
            contractInput.readOnly = false;
            contractSize = +contractInput?.value;
          } else {
            contractInput.readOnly = true;
            contractSize = pairDictionary[pairKey]?.contractSize || 0;
            contractInput.value = contractSize;
            contractInput.innerHTML = contractSize;
          }
          const loss = equity * (risk / 100);
          const lot = loss / stop / (contractSize / (pair?.nonUSD ? price : 1));
          expectedLossSpan.innerHTML = (-loss).toFixed(2);
          expectedLotSpan.innerHTML = lot.toFixed(2);
        }
      }
    </script>
  </body>
</html>
